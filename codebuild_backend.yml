version: 0.2

phases:
  install:
    runtime-versions:
      python: 3.x
    commands:
      - echo "Installing AWS CLI"
      - pip install --upgrade awscli
      - echo "AWS CLI version:"
      - aws --version

  pre_build:
    commands:
      - echo "Starting pre-build phase"
      - echo "Validating the CloudFormation template"
      # Validate your CloudFormation template before deployment
      - aws cloudformation validate-template --template-body file://template_updated.yml

  build:
    commands:
      - echo "Starting build phase"
      # Package and upload any necessary assets, if needed

      - echo "Deploying CloudFormation stack"
      # Deploy the CloudFormation stack
      - aws cloudformation deploy --template-file template_updated.yml --stack-name BaseInfraStack-dev --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM --no-fail-on-empty-changeset

      # Wait for the CloudFormation stack deployment to complete
      - echo "Waiting for CloudFormation stack to complete deployment"
      - aws cloudformation wait stack-create-complete --stack-name BaseInfraStack-dev

  post_build:
    commands:
      - echo "CloudFormation stack deployment complete"
      - echo "Retrieving CloudFormation stack outputs"
      # Retrieve stack outputs after the deployment
      - aws cloudformation describe-stacks --stack-name BaseInfraStack-dev

artifacts:
  files:
    - "**/*"
  discard-paths: yes
